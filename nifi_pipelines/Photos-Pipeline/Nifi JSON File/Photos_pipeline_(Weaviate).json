{"flowContents":{"identifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f","instanceIdentifier":"700466eb-0197-1000-effd-556f30e26be1","name":"Photos pipeline (Weaviate)","comments":"","position":{"x":-288.0,"y":160.0},"processGroups":[],"remoteProcessGroups":[],"processors":[{"identifier":"2946cb85-add1-36f1-9bf0-f27fc9f37454","instanceIdentifier":"701e57e0-0197-1000-4e15-2700cb97ad07","name":"LogAttribute","comments":"","position":{"x":-1976.0,"y":176.0},"type":"org.apache.nifi.processors.standard.LogAttribute","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"Log prefix":null,"character-set":"UTF-8","Log FlowFile Properties":"true","Log Level":"info","attributes-to-ignore-regex":null,"Attributes to Ignore":null,"Attributes to Log":null,"attributes-to-log-regex":".*","Output Format":"Line per Attribute","Log Payload":"false"},"propertyDescriptors":{"Log prefix":{"name":"Log prefix","displayName":"Log prefix","identifiesControllerService":false,"sensitive":false,"dynamic":false},"character-set":{"name":"character-set","displayName":"Character Set","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Log FlowFile Properties":{"name":"Log FlowFile Properties","displayName":"Log FlowFile Properties","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Log Level":{"name":"Log Level","displayName":"Log Level","identifiesControllerService":false,"sensitive":false,"dynamic":false},"attributes-to-ignore-regex":{"name":"attributes-to-ignore-regex","displayName":"Attributes to Ignore by Regular Expression","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Attributes to Ignore":{"name":"Attributes to Ignore","displayName":"Attributes to Ignore","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Attributes to Log":{"name":"Attributes to Log","displayName":"Attributes to Log","identifiesControllerService":false,"sensitive":false,"dynamic":false},"attributes-to-log-regex":{"name":"attributes-to-log-regex","displayName":"Attributes to Log by Regular Expression","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Output Format":{"name":"Output Format","displayName":"Output Format","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Log Payload":{"name":"Log Payload","displayName":"Log Payload","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":25,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":[],"scheduledState":"DISABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"cbefa712-d585-30eb-8d3b-e7a82f0bf008","instanceIdentifier":"77824cb7-0197-1000-7014-56035af82f16","name":"Generate Embedding","comments":"","position":{"x":-752.0,"y":-248.0},"type":"org.apache.nifi.processors.standard.InvokeHTTP","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"Request Content-Encoding":"DISABLED","proxy-configuration-service":null,"Request Multipart Form-Data Filename Enabled":"true","Request Chunked Transfer-Encoding Enabled":"false","Response Header Request Attributes Prefix":null,"HTTP/2 Disabled":"False","Connection Timeout":"5 secs","Response Cookie Strategy":"DISABLED","Socket Read Timeout":"15 secs","Socket Idle Connections":"5","Request Body Enabled":"true","api-key":"#{api-key}","OAuth2 Access Token Refresh Strategy":"ON_TOKEN_EXPIRATION","HTTP URL":"#{embedding-endpoint}","Request OAuth2 Access Token Provider":null,"Socket Idle Timeout":"5 mins","Response Redirects Enabled":"True","Socket Write Timeout":"15 secs","Request Header Attributes Pattern":null,"Response FlowFile Naming Strategy":"RANDOM","Response Cache Enabled":"false","Request Date Header Enabled":"True","Request Failure Penalization Enabled":"false","Response Body Attribute Size":"256","SSL Context Service":null,"Response Generation Required":"false","Request User-Agent":null,"Response Header Request Attributes Enabled":"false","HTTP Method":"POST","Request Username":null,"Request Content-Type":"${mime.type}","Response Body Attribute Name":null,"Request Digest Authentication Enabled":"false","Request Multipart Form-Data Name":null,"Response Cache Size":"10MB","Response Body Ignored":"false"},"propertyDescriptors":{"Request Content-Encoding":{"name":"Request Content-Encoding","displayName":"Request Content-Encoding","identifiesControllerService":false,"sensitive":false,"dynamic":false},"proxy-configuration-service":{"name":"proxy-configuration-service","displayName":"Proxy Configuration Service","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Request Multipart Form-Data Filename Enabled":{"name":"Request Multipart Form-Data Filename Enabled","displayName":"Request Multipart Form-Data Filename Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Chunked Transfer-Encoding Enabled":{"name":"Request Chunked Transfer-Encoding Enabled","displayName":"Request Chunked Transfer-Encoding Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Header Request Attributes Prefix":{"name":"Response Header Request Attributes Prefix","displayName":"Response Header Request Attributes Prefix","identifiesControllerService":false,"sensitive":false,"dynamic":false},"HTTP/2 Disabled":{"name":"HTTP/2 Disabled","displayName":"HTTP/2 Disabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Connection Timeout":{"name":"Connection Timeout","displayName":"Connection Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Cookie Strategy":{"name":"Response Cookie Strategy","displayName":"Response Cookie Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Password":{"name":"Request Password","displayName":"Request Password","identifiesControllerService":false,"sensitive":true,"dynamic":false},"Socket Read Timeout":{"name":"Socket Read Timeout","displayName":"Socket Read Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Socket Idle Connections":{"name":"Socket Idle Connections","displayName":"Socket Idle Connections","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Body Enabled":{"name":"Request Body Enabled","displayName":"Request Body Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"api-key":{"name":"api-key","displayName":"api-key","identifiesControllerService":false,"sensitive":true,"dynamic":true},"OAuth2 Access Token Refresh Strategy":{"name":"OAuth2 Access Token Refresh Strategy","displayName":"OAuth2 Access Token Refresh Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"HTTP URL":{"name":"HTTP URL","displayName":"HTTP URL","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request OAuth2 Access Token Provider":{"name":"Request OAuth2 Access Token Provider","displayName":"Request OAuth2 Access Token Provider","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Socket Idle Timeout":{"name":"Socket Idle Timeout","displayName":"Socket Idle Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Redirects Enabled":{"name":"Response Redirects Enabled","displayName":"Response Redirects Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Socket Write Timeout":{"name":"Socket Write Timeout","displayName":"Socket Write Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Header Attributes Pattern":{"name":"Request Header Attributes Pattern","displayName":"Request Header Attributes Pattern","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response FlowFile Naming Strategy":{"name":"Response FlowFile Naming Strategy","displayName":"Response FlowFile Naming Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Cache Enabled":{"name":"Response Cache Enabled","displayName":"Response Cache Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Date Header Enabled":{"name":"Request Date Header Enabled","displayName":"Request Date Header Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Failure Penalization Enabled":{"name":"Request Failure Penalization Enabled","displayName":"Request Failure Penalization Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Body Attribute Size":{"name":"Response Body Attribute Size","displayName":"Response Body Attribute Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"SSL Context Service":{"name":"SSL Context Service","displayName":"SSL Context Service","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Response Generation Required":{"name":"Response Generation Required","displayName":"Response Generation Required","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request User-Agent":{"name":"Request User-Agent","displayName":"Request User-Agent","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Header Request Attributes Enabled":{"name":"Response Header Request Attributes Enabled","displayName":"Response Header Request Attributes Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"HTTP Method":{"name":"HTTP Method","displayName":"HTTP Method","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Username":{"name":"Request Username","displayName":"Request Username","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Content-Type":{"name":"Request Content-Type","displayName":"Request Content-Type","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Body Attribute Name":{"name":"Response Body Attribute Name","displayName":"Response Body Attribute Name","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Digest Authentication Enabled":{"name":"Request Digest Authentication Enabled","displayName":"Request Digest Authentication Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Multipart Form-Data Name":{"name":"Request Multipart Form-Data Name","displayName":"Request Multipart Form-Data Name","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Cache Size":{"name":"Response Cache Size","displayName":"Response Cache Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Body Ignored":{"name":"Response Body Ignored","displayName":"Response Body Ignored","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["No Retry","Retry","Original","Failure"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"5be86a18-5207-359b-bac9-04e00d6e8c90","instanceIdentifier":"701d7b2f-0197-1000-5929-3f4b6d128102","name":"Metadata Mapping","comments":"To extract all the json files and map them to their images","position":{"x":-752.0,"y":-640.0},"type":"org.apache.nifi.processors.script.ExecuteScript","bundle":{"group":"org.apache.nifi","artifact":"nifi-scripting-nar","version":"2.4.0"},"properties":{"Script File":null,"Script Engine":"Groovy","Script Body":"// Import necessary NiFi classes\nimport org.apache.nifi.flowfile.attributes.CoreAttributes\nimport org.apache.nifi.processor.Relationship // <--- IMPORTANT: Import Relationship class\nimport java.nio.file.Paths\nimport java.nio.file.Files\nimport java.nio.file.DirectoryStream\n\n// Define Relationships for NiFi 2.x - these are discovered by the processor upon startup\ndef REL_SUCCESS = new Relationship.Builder().name(\"success\").description(\"Successfully processed FlowFile\").build()\ndef REL_FAILURE = new Relationship.Builder().name(\"failure\").description(\"Failed to process FlowFile\").build()\ndef REL_NO_METADATA_FOUND = new Relationship.Builder().name(\"no.metadata.found\").description(\"No matching metadata JSON file found\").build()\n\n\n// 'session', 'context', and 'log' are directly available in NiFi 2.x ExecuteScript\ndef flowFile = session.get()\n\nif (flowFile != null) {\n    def imageDirectoryPath = flowFile.getAttribute(CoreAttributes.ABSOLUTE_PATH.key())\n    def imageFilename = flowFile.getAttribute(CoreAttributes.FILENAME.key()) // e.g., \"image.jpeg\"\n\n    // Extract the base name of the image (without its *last* extension)\n    // Example: \"image.jpeg\" -> \"image\"\n    // Example: \"image.tar.gz\" -> \"image.tar\"\n    def baseImageFilenameNoExt = \"\"\n    def lastDotIndex = imageFilename.lastIndexOf('.')\n    if (lastDotIndex != -1) {\n        baseImageFilenameNoExt = imageFilename.substring(0, lastDotIndex)\n    } else {\n        baseImageFilenameNoExt = imageFilename // No extension, use full filename as base\n    }\n\n    def metadataFound = false\n    def metadataFilePath = null\n\n    try {\n        def directory = Paths.get(imageDirectoryPath)\n\n        // Step 1: Broad search for any JSON file starting with the image's base name\n        // This cast a wide net: e.g., for \"image.jpeg\", it will find \"image.jpe.json\", \"image.jpg.json\", \"image.json\", etc.\n        Files.newDirectoryStream(directory, \"${baseImageFilenameNoExt}*.json\").each { path ->\n            def currentJsonFilename = path.getFileName().toString()\n\n            // Step 2: Refine the match with specific rules\n            // Rule A: Matches if the JSON filename starts exactly with the full image filename\n            //         (e.g., \"cows.jpg.json\", \"cows.jpg.supplemental-metadata.json\" for \"cows.jpg\")\n            if (currentJsonFilename.startsWith(imageFilename)) {\n                metadataFilePath = path.toAbsolutePath().toString()\n                metadataFound = true\n                log.info(\"Rule A: Found matching metadata file: ${metadataFilePath} for image: ${imageFilename}\")\n                return // Break from each loop\n            }\n\n            // Rule B: Matches if the JSON filename starts with the image's base name (no extension)\n            //         AND has a different extension-like part before '.json'.\n            //         (e.g., \"sumatran-tiger.jpe.json\" for \"sumatran-tiger.jpeg\")\n            //         This handles cases where the metadata file's extension differs from the image's.\n            if (currentJsonFilename.startsWith(baseImageFilenameNoExt) &&\n                currentJsonFilename.length() > baseImageFilenameNoExt.length() && // Ensure there's content after base name\n                currentJsonFilename.substring(baseImageFilenameNoExt.length()).contains(\".\") // Ensure that content includes a dot (like an extension)\n               ) {\n                // Further check to make sure it's specifically for this image and not another file with similar prefix\n                // This is the tricky part. For Google Takeout, the filename usually matches exactly or with a '.ext.json' suffix.\n                // Given \"sumatran-tiger-tiger-big-cat-stripes-46251.jpe.json\" for \"sumatran-tiger-tiger-big-cat-stripes-46251.jpeg\",\n                // This condition should match.\n                metadataFilePath = path.toAbsolutePath().toString()\n                metadataFound = true\n                log.info(\"Rule B: Found matching metadata file: ${metadataFilePath} for image: ${imageFilename}\")\n                return // Break from each loop\n            }\n        }\n\n        if (metadataFound) {\n            def metadataContent = new String(Files.readAllBytes(Paths.get(metadataFilePath)), 'UTF-8')\n            flowFile = session.putAttribute(flowFile, 'google.metadata', metadataContent)\n            session.transfer(flowFile, REL_SUCCESS)\n        } else {\n            log.warn(\"No matching metadata JSON file found for image: '${imageFilename}' in directory: '${imageDirectoryPath}'. Routing to 'NO_METADATA_FOUND' relationship.\")\n            session.transfer(flowFile, REL_NO_METADATA_FOUND)\n        }\n\n    } catch (Exception e) {\n        log.error(\"Error processing metadata for '${imageFilename}': ${e.message}\", e)\n        session.transfer(flowFile, REL_FAILURE)\n    }\n} else {\n    log.warn(\"No FlowFile available to process.\")\n}","Module Directory":null},"propertyDescriptors":{"Script File":{"name":"Script File","displayName":"Script File","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"SINGLE","resourceTypes":["FILE"]}},"Script Engine":{"name":"Script Engine","displayName":"Script Engine","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Script Body":{"name":"Script Body","displayName":"Script Body","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Module Directory":{"name":"Module Directory","displayName":"Module Directory","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"MULTIPLE","resourceTypes":["FILE","DIRECTORY"]}}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"fc8634fd-c7b5-346e-8c45-918b5e8d498d","instanceIdentifier":"78027abd-0197-1000-8e3a-54c122fb6cdf","name":"Upsert to Weaviate","comments":"","position":{"x":-1976.0,"y":-24.0},"type":"org.apache.nifi.processors.standard.InvokeHTTP","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"Request Content-Encoding":"DISABLED","proxy-configuration-service":null,"Request Multipart Form-Data Filename Enabled":"true","Request Chunked Transfer-Encoding Enabled":"false","Response Header Request Attributes Prefix":null,"HTTP/2 Disabled":"False","Connection Timeout":"5 secs","Response Cookie Strategy":"DISABLED","Authorization":"#{weaviate-api-key}","Socket Read Timeout":"15 secs","Socket Idle Connections":"5","Request Body Enabled":"true","OAuth2 Access Token Refresh Strategy":"ON_TOKEN_EXPIRATION","HTTP URL":"#{weaviate-endpoint}","Request OAuth2 Access Token Provider":null,"Socket Idle Timeout":"5 mins","Response Redirects Enabled":"True","Socket Write Timeout":"15 secs","Request Header Attributes Pattern":null,"Response FlowFile Naming Strategy":"RANDOM","Response Cache Enabled":"false","Request Date Header Enabled":"True","Request Failure Penalization Enabled":"false","Response Body Attribute Size":"256","SSL Context Service":null,"Response Generation Required":"false","Request User-Agent":null,"Response Header Request Attributes Enabled":"false","HTTP Method":"POST","Request Username":null,"Request Content-Type":"application/json","Response Body Attribute Name":null,"Request Digest Authentication Enabled":"false","Request Multipart Form-Data Name":null,"Response Cache Size":"10MB","Response Body Ignored":"false"},"propertyDescriptors":{"Request Content-Encoding":{"name":"Request Content-Encoding","displayName":"Request Content-Encoding","identifiesControllerService":false,"sensitive":false,"dynamic":false},"proxy-configuration-service":{"name":"proxy-configuration-service","displayName":"Proxy Configuration Service","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Request Multipart Form-Data Filename Enabled":{"name":"Request Multipart Form-Data Filename Enabled","displayName":"Request Multipart Form-Data Filename Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Chunked Transfer-Encoding Enabled":{"name":"Request Chunked Transfer-Encoding Enabled","displayName":"Request Chunked Transfer-Encoding Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Header Request Attributes Prefix":{"name":"Response Header Request Attributes Prefix","displayName":"Response Header Request Attributes Prefix","identifiesControllerService":false,"sensitive":false,"dynamic":false},"HTTP/2 Disabled":{"name":"HTTP/2 Disabled","displayName":"HTTP/2 Disabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Connection Timeout":{"name":"Connection Timeout","displayName":"Connection Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Cookie Strategy":{"name":"Response Cookie Strategy","displayName":"Response Cookie Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Authorization":{"name":"Authorization","displayName":"Authorization","identifiesControllerService":false,"sensitive":true,"dynamic":true},"Request Password":{"name":"Request Password","displayName":"Request Password","identifiesControllerService":false,"sensitive":true,"dynamic":false},"Socket Read Timeout":{"name":"Socket Read Timeout","displayName":"Socket Read Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Socket Idle Connections":{"name":"Socket Idle Connections","displayName":"Socket Idle Connections","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Body Enabled":{"name":"Request Body Enabled","displayName":"Request Body Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"OAuth2 Access Token Refresh Strategy":{"name":"OAuth2 Access Token Refresh Strategy","displayName":"OAuth2 Access Token Refresh Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"HTTP URL":{"name":"HTTP URL","displayName":"HTTP URL","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request OAuth2 Access Token Provider":{"name":"Request OAuth2 Access Token Provider","displayName":"Request OAuth2 Access Token Provider","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Socket Idle Timeout":{"name":"Socket Idle Timeout","displayName":"Socket Idle Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Redirects Enabled":{"name":"Response Redirects Enabled","displayName":"Response Redirects Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Socket Write Timeout":{"name":"Socket Write Timeout","displayName":"Socket Write Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Header Attributes Pattern":{"name":"Request Header Attributes Pattern","displayName":"Request Header Attributes Pattern","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response FlowFile Naming Strategy":{"name":"Response FlowFile Naming Strategy","displayName":"Response FlowFile Naming Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Cache Enabled":{"name":"Response Cache Enabled","displayName":"Response Cache Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Date Header Enabled":{"name":"Request Date Header Enabled","displayName":"Request Date Header Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Failure Penalization Enabled":{"name":"Request Failure Penalization Enabled","displayName":"Request Failure Penalization Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Body Attribute Size":{"name":"Response Body Attribute Size","displayName":"Response Body Attribute Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"SSL Context Service":{"name":"SSL Context Service","displayName":"SSL Context Service","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Response Generation Required":{"name":"Response Generation Required","displayName":"Response Generation Required","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request User-Agent":{"name":"Request User-Agent","displayName":"Request User-Agent","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Header Request Attributes Enabled":{"name":"Response Header Request Attributes Enabled","displayName":"Response Header Request Attributes Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"HTTP Method":{"name":"HTTP Method","displayName":"HTTP Method","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Username":{"name":"Request Username","displayName":"Request Username","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Content-Type":{"name":"Request Content-Type","displayName":"Request Content-Type","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Body Attribute Name":{"name":"Response Body Attribute Name","displayName":"Response Body Attribute Name","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Digest Authentication Enabled":{"name":"Request Digest Authentication Enabled","displayName":"Request Digest Authentication Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Multipart Form-Data Name":{"name":"Request Multipart Form-Data Name","displayName":"Request Multipart Form-Data Name","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Cache Size":{"name":"Response Cache Size","displayName":"Response Cache Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Body Ignored":{"name":"Response Body Ignored","displayName":"Response Body Ignored","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["No Retry","Retry","Original"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"5d57b6ab-c54a-3e86-be95-2482bc910a28","instanceIdentifier":"73eb48ce-0197-1000-ad10-295a79433eba","name":"Payload for Summary","comments":"To make the json schema to feed the LLM having the base64 encoded image data","position":{"x":-1352.0,"y":-440.0},"type":"org.apache.nifi.processors.script.ExecuteScript","bundle":{"group":"org.apache.nifi","artifact":"nifi-scripting-nar","version":"2.4.0"},"properties":{"Script File":null,"Script Engine":"Groovy","Script Body":"// Import necessary classes\nimport org.apache.nifi.processor.io.InputStreamCallback\nimport org.apache.nifi.processor.io.OutputStreamCallback // Ensure this is imported\nimport org.apache.nifi.processor.Relationship\nimport java.nio.charset.StandardCharsets\nimport groovy.json.JsonOutput // For converting Map to JSON\n\n// Define Relationships (already defined, but keep for completeness)\ndef REL_SUCCESS = new Relationship.Builder().name(\"success\").description(\"Successfully processed FlowFile\").build()\ndef REL_FAILURE = new Relationship.Builder().name(\"failure\").description(\"Failed to process FlowFile\").build()\n\n\ndef flowFile = session.get()\nif (flowFile != null) {\n    try {\n        // Read the Base64 image content from the FlowFile\n        def base64ImageContent = new StringBuilder()\n        session.read(flowFile, { inputStream ->\n            base64ImageContent.append(new String(inputStream.readAllBytes(), StandardCharsets.UTF_8))\n        } as InputStreamCallback)\n\n        // Step 1: Create a standard Groovy Map representing the entire JSON structure\n        def llmPayloadMap = [\n            model: \"gpt-4o\", // Or your preferred multimodal model\n            messages: [\n                [\n                    role: \"user\",\n                    content: [\n                        [\n                            type: \"text\",\n                            text: \"Describe this image for a photo search engine. Be descriptive but concise. Mention people, animals, objects, colors, and the general setting.\"\n                        ],\n                        [\n                            type: \"image_url\",\n                            image_url: [\n                                url: \"data:image/jpeg;base64,${base64ImageContent}\" // Embed Base64 content\n                            ]\n                        ]\n                    ]\n                ]\n            ],\n            max_tokens: 150\n        ]\n\n        // Step 2: Convert the Groovy Map directly to a JSON string\n        def jsonString = JsonOutput.toJson(llmPayloadMap)\n        // Optionally pretty print it for readability in logs/debug, not strictly needed for API calls\n        jsonString = JsonOutput.prettyPrint(jsonString)\n\n\n        // Write the new JSON payload back to the FlowFile content\n        flowFile = session.write(flowFile, { outputStream ->\n            outputStream.write(jsonString.getBytes(StandardCharsets.UTF_8))\n        } as OutputStreamCallback)\n\n        // Update FlowFile mime.type attribute for downstream processors\n        flowFile = session.putAttribute(flowFile, \"mime.type\", \"application/json\")\n\n        session.transfer(flowFile, REL_SUCCESS)\n\n    } catch (Exception e) {\n        log.error(\"Error building LLM JSON payload for FlowFile ${flowFile.getId()}: ${e.message}\", e)\n        session.transfer(flowFile, REL_FAILURE)\n    }\n} else {\n    log.warn(\"No FlowFile available to process in LLM Payload Builder script.\")\n}","Module Directory":null},"propertyDescriptors":{"Script File":{"name":"Script File","displayName":"Script File","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"SINGLE","resourceTypes":["FILE"]}},"Script Engine":{"name":"Script Engine","displayName":"Script Engine","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Script Body":{"name":"Script Body","displayName":"Script Body","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Module Directory":{"name":"Module Directory","displayName":"Module Directory","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"MULTIPLE","resourceTypes":["FILE","DIRECTORY"]}}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"8056ba53-da3c-32e3-9fda-e09948a83020","instanceIdentifier":"78121f9f-0197-1000-9590-69bc78c3b540","name":"LogAttribute","comments":"","position":{"x":-2584.0,"y":0.0},"type":"org.apache.nifi.processors.standard.LogAttribute","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"Log prefix":null,"character-set":"UTF-8","Log FlowFile Properties":"true","Log Level":"info","attributes-to-ignore-regex":null,"Attributes to Ignore":null,"Attributes to Log":null,"attributes-to-log-regex":".*","Output Format":"Line per Attribute","Log Payload":"false"},"propertyDescriptors":{"Log prefix":{"name":"Log prefix","displayName":"Log prefix","identifiesControllerService":false,"sensitive":false,"dynamic":false},"character-set":{"name":"character-set","displayName":"Character Set","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Log FlowFile Properties":{"name":"Log FlowFile Properties","displayName":"Log FlowFile Properties","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Log Level":{"name":"Log Level","displayName":"Log Level","identifiesControllerService":false,"sensitive":false,"dynamic":false},"attributes-to-ignore-regex":{"name":"attributes-to-ignore-regex","displayName":"Attributes to Ignore by Regular Expression","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Attributes to Ignore":{"name":"Attributes to Ignore","displayName":"Attributes to Ignore","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Attributes to Log":{"name":"Attributes to Log","displayName":"Attributes to Log","identifiesControllerService":false,"sensitive":false,"dynamic":false},"attributes-to-log-regex":{"name":"attributes-to-log-regex","displayName":"Attributes to Log by Regular Expression","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Output Format":{"name":"Output Format","displayName":"Output Format","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Log Payload":{"name":"Log Payload","displayName":"Log Payload","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":25,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":[],"scheduledState":"DISABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"1442a392-bc4b-38ce-b098-44fd0a8b6cf7","instanceIdentifier":"7010f8c4-0197-1000-83c5-e834f34e6d3b","name":"ListFile","comments":"","position":{"x":-1976.0,"y":-640.0},"type":"org.apache.nifi.processors.standard.ListFile","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"Minimum File Age":"0 sec","et-initial-listing-target":"all","Maximum File Age":null,"max-listing-time":"3 mins","record-writer":null,"Maximum File Size":null,"et-time-window":"3 hours","et-node-identifier":"${hostname()}","Recurse Subdirectories":"true","File Filter":"[^\\.].*\\.(jpg|jpeg|png|heic)","Path Filter":null,"Include File Attributes":"true","Input Directory Location":"Local","listing-strategy":"timestamps","Input Directory":"/home/shtlp_0058/Pictures/Takeout/Google Photos","target-system-timestamp-precision":"auto-detect","track-performance":"false","max-performance-metrics":"100000","Minimum File Size":"0 B","Ignore Hidden Files":"true","et-state-cache":null,"max-operation-time":"10 secs"},"propertyDescriptors":{"Minimum File Age":{"name":"Minimum File Age","displayName":"Minimum File Age","identifiesControllerService":false,"sensitive":false,"dynamic":false},"et-initial-listing-target":{"name":"et-initial-listing-target","displayName":"Entity Tracking Initial Listing Target","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Maximum File Age":{"name":"Maximum File Age","displayName":"Maximum File Age","identifiesControllerService":false,"sensitive":false,"dynamic":false},"max-listing-time":{"name":"max-listing-time","displayName":"Max Directory Listing Time","identifiesControllerService":false,"sensitive":false,"dynamic":false},"record-writer":{"name":"record-writer","displayName":"Record Writer","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Maximum File Size":{"name":"Maximum File Size","displayName":"Maximum File Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"et-time-window":{"name":"et-time-window","displayName":"Entity Tracking Time Window","identifiesControllerService":false,"sensitive":false,"dynamic":false},"et-node-identifier":{"name":"et-node-identifier","displayName":"Entity Tracking Node Identifier","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Recurse Subdirectories":{"name":"Recurse Subdirectories","displayName":"Recurse Subdirectories","identifiesControllerService":false,"sensitive":false,"dynamic":false},"File Filter":{"name":"File Filter","displayName":"File Filter","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Path Filter":{"name":"Path Filter","displayName":"Path Filter","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Include File Attributes":{"name":"Include File Attributes","displayName":"Include File Attributes","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Input Directory Location":{"name":"Input Directory Location","displayName":"Input Directory Location","identifiesControllerService":false,"sensitive":false,"dynamic":false},"listing-strategy":{"name":"listing-strategy","displayName":"Listing Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Input Directory":{"name":"Input Directory","displayName":"Input Directory","identifiesControllerService":false,"sensitive":false,"dynamic":false},"target-system-timestamp-precision":{"name":"target-system-timestamp-precision","displayName":"Target System Timestamp Precision","identifiesControllerService":false,"sensitive":false,"dynamic":false},"track-performance":{"name":"track-performance","displayName":"Track Performance","identifiesControllerService":false,"sensitive":false,"dynamic":false},"max-performance-metrics":{"name":"max-performance-metrics","displayName":"Maximum Number of Files to Track","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Minimum File Size":{"name":"Minimum File Size","displayName":"Minimum File Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Ignore Hidden Files":{"name":"Ignore Hidden Files","displayName":"Ignore Hidden Files","identifiesControllerService":false,"sensitive":false,"dynamic":false},"et-state-cache":{"name":"et-state-cache","displayName":"Entity Tracking State Cache","identifiesControllerService":true,"sensitive":false,"dynamic":false},"max-operation-time":{"name":"max-operation-time","displayName":"Max Disk Operation Time","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"1 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":[],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"5adab250-799d-3f84-bbd2-4c4c8c7cfd14","instanceIdentifier":"74a3d9a1-0197-1000-3d63-3ae85cdd7adf","name":"Generate Summary","comments":"","position":{"x":-1976.0,"y":-440.0},"type":"org.apache.nifi.processors.standard.InvokeHTTP","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"Request Content-Encoding":"DISABLED","proxy-configuration-service":null,"Request Multipart Form-Data Filename Enabled":"true","Request Chunked Transfer-Encoding Enabled":"false","Response Header Request Attributes Prefix":null,"HTTP/2 Disabled":"False","Connection Timeout":"5 secs","Response Cookie Strategy":"DISABLED","Socket Read Timeout":"15 secs","Socket Idle Connections":"5","Request Body Enabled":"true","api-key":"#{api-key}","OAuth2 Access Token Refresh Strategy":"ON_TOKEN_EXPIRATION","HTTP URL":"#{chat-endpoint}","Request OAuth2 Access Token Provider":null,"Socket Idle Timeout":"5 mins","Response Redirects Enabled":"True","Socket Write Timeout":"15 secs","Request Header Attributes Pattern":null,"Response FlowFile Naming Strategy":"RANDOM","Response Cache Enabled":"false","Request Date Header Enabled":"True","Request Failure Penalization Enabled":"false","Response Body Attribute Size":"256","SSL Context Service":null,"Response Generation Required":"false","Request User-Agent":null,"Response Header Request Attributes Enabled":"false","HTTP Method":"POST","Request Username":null,"Request Content-Type":"application/json","Response Body Attribute Name":null,"Request Digest Authentication Enabled":"false","Request Multipart Form-Data Name":null,"Response Cache Size":"10MB","Response Body Ignored":"false"},"propertyDescriptors":{"Request Content-Encoding":{"name":"Request Content-Encoding","displayName":"Request Content-Encoding","identifiesControllerService":false,"sensitive":false,"dynamic":false},"proxy-configuration-service":{"name":"proxy-configuration-service","displayName":"Proxy Configuration Service","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Request Multipart Form-Data Filename Enabled":{"name":"Request Multipart Form-Data Filename Enabled","displayName":"Request Multipart Form-Data Filename Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Chunked Transfer-Encoding Enabled":{"name":"Request Chunked Transfer-Encoding Enabled","displayName":"Request Chunked Transfer-Encoding Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Header Request Attributes Prefix":{"name":"Response Header Request Attributes Prefix","displayName":"Response Header Request Attributes Prefix","identifiesControllerService":false,"sensitive":false,"dynamic":false},"HTTP/2 Disabled":{"name":"HTTP/2 Disabled","displayName":"HTTP/2 Disabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Connection Timeout":{"name":"Connection Timeout","displayName":"Connection Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Cookie Strategy":{"name":"Response Cookie Strategy","displayName":"Response Cookie Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Password":{"name":"Request Password","displayName":"Request Password","identifiesControllerService":false,"sensitive":true,"dynamic":false},"Socket Read Timeout":{"name":"Socket Read Timeout","displayName":"Socket Read Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Socket Idle Connections":{"name":"Socket Idle Connections","displayName":"Socket Idle Connections","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Body Enabled":{"name":"Request Body Enabled","displayName":"Request Body Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"api-key":{"name":"api-key","displayName":"api-key","identifiesControllerService":false,"sensitive":true,"dynamic":true},"OAuth2 Access Token Refresh Strategy":{"name":"OAuth2 Access Token Refresh Strategy","displayName":"OAuth2 Access Token Refresh Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"HTTP URL":{"name":"HTTP URL","displayName":"HTTP URL","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request OAuth2 Access Token Provider":{"name":"Request OAuth2 Access Token Provider","displayName":"Request OAuth2 Access Token Provider","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Socket Idle Timeout":{"name":"Socket Idle Timeout","displayName":"Socket Idle Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Redirects Enabled":{"name":"Response Redirects Enabled","displayName":"Response Redirects Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Socket Write Timeout":{"name":"Socket Write Timeout","displayName":"Socket Write Timeout","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Header Attributes Pattern":{"name":"Request Header Attributes Pattern","displayName":"Request Header Attributes Pattern","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response FlowFile Naming Strategy":{"name":"Response FlowFile Naming Strategy","displayName":"Response FlowFile Naming Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Cache Enabled":{"name":"Response Cache Enabled","displayName":"Response Cache Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Date Header Enabled":{"name":"Request Date Header Enabled","displayName":"Request Date Header Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Failure Penalization Enabled":{"name":"Request Failure Penalization Enabled","displayName":"Request Failure Penalization Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Body Attribute Size":{"name":"Response Body Attribute Size","displayName":"Response Body Attribute Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"SSL Context Service":{"name":"SSL Context Service","displayName":"SSL Context Service","identifiesControllerService":true,"sensitive":false,"dynamic":false},"Response Generation Required":{"name":"Response Generation Required","displayName":"Response Generation Required","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request User-Agent":{"name":"Request User-Agent","displayName":"Request User-Agent","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Header Request Attributes Enabled":{"name":"Response Header Request Attributes Enabled","displayName":"Response Header Request Attributes Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"HTTP Method":{"name":"HTTP Method","displayName":"HTTP Method","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Username":{"name":"Request Username","displayName":"Request Username","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Content-Type":{"name":"Request Content-Type","displayName":"Request Content-Type","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Body Attribute Name":{"name":"Response Body Attribute Name","displayName":"Response Body Attribute Name","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Digest Authentication Enabled":{"name":"Request Digest Authentication Enabled","displayName":"Request Digest Authentication Enabled","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Request Multipart Form-Data Name":{"name":"Request Multipart Form-Data Name","displayName":"Request Multipart Form-Data Name","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Cache Size":{"name":"Response Cache Size","displayName":"Response Cache Size","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Response Body Ignored":{"name":"Response Body Ignored","displayName":"Response Body Ignored","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["No Retry","Retry","Original","Failure"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"36fbd810-3d0e-3bda-aae0-e823e6a38288","instanceIdentifier":"701514bd-0197-1000-7899-68971eff9a70","name":"FetchFile","comments":"","position":{"x":-1352.0,"y":-640.0},"type":"org.apache.nifi.processors.standard.FetchFile","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"Move Conflict Strategy":"Rename","Log level when file not found":"ERROR","Move Destination Directory":null,"Log level when permission denied":"ERROR","File to Fetch":"${absolute.path}/${filename}","Completion Strategy":"None"},"propertyDescriptors":{"Move Conflict Strategy":{"name":"Move Conflict Strategy","displayName":"Move Conflict Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Log level when file not found":{"name":"Log level when file not found","displayName":"Log level when file not found","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Move Destination Directory":{"name":"Move Destination Directory","displayName":"Move Destination Directory","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Log level when permission denied":{"name":"Log level when permission denied","displayName":"Log level when permission denied","identifiesControllerService":false,"sensitive":false,"dynamic":false},"File to Fetch":{"name":"File to Fetch","displayName":"File to Fetch","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Completion Strategy":{"name":"Completion Strategy","displayName":"Completion Strategy","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure","permission.denied","not.found"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"c345fdc9-5068-37a5-b796-bac36815946a","instanceIdentifier":"777ec58b-0197-1000-df1f-9781e129f078","name":"Prepare Embedding Payload","comments":"","position":{"x":-1352.0,"y":-248.0},"type":"org.apache.nifi.processors.script.ExecuteScript","bundle":{"group":"org.apache.nifi","artifact":"nifi-scripting-nar","version":"2.4.0"},"properties":{"Script File":null,"Script Engine":"Groovy","Script Body":"import groovy.json.JsonOutput\nimport org.apache.nifi.flowfile.FlowFile\nimport java.nio.charset.StandardCharsets\n\ndef ff = session.get()\nif (!ff) return\n\ntry {\n    def description = ff.getAttribute('llm.summary')\n    // The model (deployment id) is part of the URL for Azure OpenAI embeddings.\n    // The payload is just {\"input\": \"text_to_embed\"}\n    def payloadMap = [ input: description ]\n    def payloadJson = JsonOutput.toJson(payloadMap)\n\n    ff = session.write(ff, { outputStream ->\n        outputStream.write(payloadJson.getBytes(StandardCharsets.UTF_8))\n    } as OutputStreamCallback)\n    session.transfer(ff, REL_SUCCESS)\n} catch (e) {\n    log.error(\"Error preparing Embedding payload for ${ff}: \" + e.getMessage(), e)\n    session.transfer(ff, REL_FAILURE)\n}","Module Directory":null},"propertyDescriptors":{"Script File":{"name":"Script File","displayName":"Script File","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"SINGLE","resourceTypes":["FILE"]}},"Script Engine":{"name":"Script Engine","displayName":"Script Engine","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Script Body":{"name":"Script Body","displayName":"Script Body","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Module Directory":{"name":"Module Directory","displayName":"Module Directory","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"MULTIPLE","resourceTypes":["FILE","DIRECTORY"]}}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"b4c28cd1-7abe-34f9-8748-02584678767e","instanceIdentifier":"74aa8e19-0197-1000-b460-fdb4ac3e16fc","name":"Extract Summary","comments":"","position":{"x":-1976.0,"y":-240.0},"type":"org.apache.nifi.processors.standard.EvaluateJsonPath","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"Destination":"flowfile-attribute","llm.summary":"$.choices[0].message.content","Max String Length":"20 MB","Return Type":"auto-detect","Null Value Representation":"empty string","Path Not Found Behavior":"ignore","Input Variable":"openai.description.response"},"propertyDescriptors":{"Destination":{"name":"Destination","displayName":"Destination","identifiesControllerService":false,"sensitive":false,"dynamic":false},"llm.summary":{"name":"llm.summary","displayName":"llm.summary","identifiesControllerService":false,"sensitive":false,"dynamic":true},"Max String Length":{"name":"Max String Length","displayName":"Max String Length","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Return Type":{"name":"Return Type","displayName":"Return Type","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Null Value Representation":{"name":"Null Value Representation","displayName":"Null Value Representation","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Path Not Found Behavior":{"name":"Path Not Found Behavior","displayName":"Path Not Found Behavior","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Input Variable":{"name":"Input Variable","displayName":"Input Variable","identifiesControllerService":false,"sensitive":false,"dynamic":true}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure","unmatched"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"f56f51e6-6a74-3253-96a2-f445d34ba090","instanceIdentifier":"779c5588-0197-1000-8aae-8d1415b9c5bf","name":"Prepare Weaviate Payload","comments":"","position":{"x":-1352.0,"y":-24.0},"type":"org.apache.nifi.processors.script.ExecuteScript","bundle":{"group":"org.apache.nifi","artifact":"nifi-scripting-nar","version":"2.4.0"},"properties":{"Script File":null,"Script Engine":"Groovy","Script Body":"import groovy.json.JsonOutput\nimport groovy.json.JsonSlurper\nimport org.apache.nifi.processor.io.OutputStreamCallback\nimport org.apache.nifi.processor.Relationship\nimport java.nio.charset.StandardCharsets\nimport java.util.UUID\nimport java.nio.file.Paths\n\ndef REL_SUCCESS = new Relationship.Builder().name(\"success\").description(\"Success\").build()\ndef REL_FAILURE = new Relationship.Builder().name(\"failure\").description(\"Failure\").build()\n\ndef flowFile = session.get()\nif (!flowFile) return\n\ntry {\n    def jsonSlurper = new JsonSlurper()\n    def path = flowFile.getAttribute('path')\n    def filename = flowFile.getAttribute('filename')\n    def imagePath = Paths.get(path, filename).toString()\n    def summary = flowFile.getAttribute('llm.summary') ?: \"\"\n    def embedding = jsonSlurper.parseText(flowFile.getAttribute('extracted.embedding'))\n    if (!(embedding instanceof List)) throw new Exception(\"Embedding is not a valid list\")\n\n    def metadata = flowFile.getAttribute('google.metadata') ? jsonSlurper.parseText(flowFile.getAttribute('google.metadata')) : [:]\n\n    // Derive basename (filename without extension)\n    def basename = filename.contains(\".\") ? filename[0..filename.lastIndexOf('.') - 1] : filename\n\n    // Normalize persons as text array (e.g., [\"rohit sharma\"])\n    def personsRaw = metadata?.people ?: metadata?.persons ?: []\n    def persons = personsRaw.collect {\n        if (it instanceof Map && it.name) return it.name.toLowerCase()\n        if (it instanceof String) return it.toLowerCase()\n        return null\n    }.findAll { it }\n\n    def payload = [\n        class     : \"image_search\",  // Weaviate class name\n        id        : UUID.randomUUID().toString(),\n        properties: [\n            image_path      : imagePath,\n            summary         : summary,\n            title           : metadata?.title ?: null,\n            description     : metadata?.description ?: null,\n            imageViews      : metadata?.imageViews?.toInteger() ?: null,\n            timestamp       : metadata?.photoTakenTime?.timestamp?.toLong() ?: null,\n            formatted_time  : metadata?.photoTakenTime?.formatted ?: null,\n            url             : metadata?.url ?: null,\n            latitude        : metadata?.geoData?.latitude ?: null,\n            longitude       : metadata?.geoData?.longitude ?: null,\n            altitude        : metadata?.geoData?.altitude ?: null,\n            appName         : metadata?.googlePhotosOrigin?.thirdPartyApp?.appName\n                              ?: metadata?.appSource?.androidPackageName ?: null,\n            deviceType      : metadata?.googlePhotosOrigin?.mobileUpload?.deviceType ?: null,\n            localFolderName : metadata?.googlePhotosOrigin?.mobileUpload?.deviceFolder?.localFolderName ?: null,\n            persons         : persons,\n            basename        : basename\n        ],\n        vector: embedding\n    ]\n\n    def jsonString = JsonOutput.prettyPrint(JsonOutput.toJson(payload))\n\n    flowFile = session.write(flowFile, { out -> out.write(jsonString.getBytes(StandardCharsets.UTF_8)) } as OutputStreamCallback)\n    flowFile = session.putAttribute(flowFile, \"mime.type\", \"application/json\")\n    session.transfer(flowFile, REL_SUCCESS)\n    log.info(\"✅ Weaviate upsert payload prepared for FlowFile ${flowFile.getId()}.\")\n\n} catch (Exception e) {\n    log.error(\"❌ Failed to prepare Weaviate payload: ${e.message}\", e)\n    session.transfer(flowFile, REL_FAILURE)\n}","Module Directory":null},"propertyDescriptors":{"Script File":{"name":"Script File","displayName":"Script File","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"SINGLE","resourceTypes":["FILE"]}},"Script Engine":{"name":"Script Engine","displayName":"Script Engine","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Script Body":{"name":"Script Body","displayName":"Script Body","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Module Directory":{"name":"Module Directory","displayName":"Module Directory","identifiesControllerService":false,"sensitive":false,"dynamic":false,"resourceDefinition":{"cardinality":"MULTIPLE","resourceTypes":["FILE","DIRECTORY"]}}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"166d96de-7b41-323e-a504-5a37744a3892","instanceIdentifier":"7785689b-0197-1000-1d2c-1e98d5497ae9","name":"Extract Embedding","comments":"","position":{"x":-752.0,"y":-24.0},"type":"org.apache.nifi.processors.standard.EvaluateJsonPath","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"extracted.embedding":"$.data[0].embedding","Destination":"flowfile-attribute","Max String Length":"20 MB","Return Type":"json","Null Value Representation":"empty string","Path Not Found Behavior":"ignore","Input Variable":"openai.embedding.response"},"propertyDescriptors":{"extracted.embedding":{"name":"extracted.embedding","displayName":"extracted.embedding","identifiesControllerService":false,"sensitive":false,"dynamic":true},"Destination":{"name":"Destination","displayName":"Destination","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Max String Length":{"name":"Max String Length","displayName":"Max String Length","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Return Type":{"name":"Return Type","displayName":"Return Type","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Null Value Representation":{"name":"Null Value Representation","displayName":"Null Value Representation","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Path Not Found Behavior":{"name":"Path Not Found Behavior","displayName":"Path Not Found Behavior","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Input Variable":{"name":"Input Variable","displayName":"Input Variable","identifiesControllerService":false,"sensitive":false,"dynamic":true}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure","unmatched"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"44845c8a-e889-31b0-ade5-6a3340c0c2b0","instanceIdentifier":"73947cb4-0197-1000-f7c2-44b435930aad","name":"EncodeContent","comments":"","position":{"x":-752.0,"y":-448.0},"type":"org.apache.nifi.processors.standard.EncodeContent","bundle":{"group":"org.apache.nifi","artifact":"nifi-standard-nar","version":"2.4.0"},"properties":{"Encoded Line Length":"76","Mode":"Encode","Encoding":"base64","Line Output Mode":"SINGLE_LINE"},"propertyDescriptors":{"Encoded Line Length":{"name":"Encoded Line Length","displayName":"Encoded Line Length","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Mode":{"name":"Mode","displayName":"Mode","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Encoding":{"name":"Encoding","displayName":"Encoding","identifiesControllerService":false,"sensitive":false,"dynamic":false},"Line Output Mode":{"name":"Line Output Mode","displayName":"Line Output Mode","identifiesControllerService":false,"sensitive":false,"dynamic":false}},"style":{},"schedulingPeriod":"0 sec","schedulingStrategy":"TIMER_DRIVEN","executionNode":"ALL","penaltyDuration":"30 sec","yieldDuration":"1 sec","bulletinLevel":"WARN","runDurationMillis":0,"concurrentlySchedulableTaskCount":1,"autoTerminatedRelationships":["failure"],"scheduledState":"ENABLED","retryCount":10,"retriedRelationships":[],"backoffMechanism":"PENALIZE_FLOWFILE","maxBackoffPeriod":"10 mins","componentType":"PROCESSOR","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"}],"inputPorts":[],"outputPorts":[],"connections":[{"identifier":"ecd497f1-6f7b-344d-81b7-87718ce4c2c1","instanceIdentifier":"779c9c23-0197-1000-5465-c6b9313999ed","name":"","source":{"id":"f56f51e6-6a74-3253-96a2-f445d34ba090","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Prepare Weaviate Payload","comments":"","instanceIdentifier":"779c5588-0197-1000-8aae-8d1415b9c5bf"},"destination":{"id":"fc8634fd-c7b5-346e-8c45-918b5e8d498d","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Upsert to Weaviate","comments":"","instanceIdentifier":"78027abd-0197-1000-8e3a-54c122fb6cdf"},"labelIndex":0,"zIndex":13,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"31094729-9f43-34c4-86c4-85076bfbea4d","instanceIdentifier":"7051831a-0197-1000-bcf8-831e541e1e37","name":"","source":{"id":"1442a392-bc4b-38ce-b098-44fd0a8b6cf7","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"ListFile","comments":"","instanceIdentifier":"7010f8c4-0197-1000-83c5-e834f34e6d3b"},"destination":{"id":"36fbd810-3d0e-3bda-aae0-e823e6a38288","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"FetchFile","comments":"","instanceIdentifier":"701514bd-0197-1000-7899-68971eff9a70"},"labelIndex":0,"zIndex":5,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"bcd653be-001f-3f34-9bc3-fe392a56f077","instanceIdentifier":"7785c67d-0197-1000-7954-3748d9e054d6","name":"","source":{"id":"166d96de-7b41-323e-a504-5a37744a3892","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Extract Embedding","comments":"","instanceIdentifier":"7785689b-0197-1000-1d2c-1e98d5497ae9"},"destination":{"id":"f56f51e6-6a74-3253-96a2-f445d34ba090","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Prepare Weaviate Payload","comments":"","instanceIdentifier":"779c5588-0197-1000-8aae-8d1415b9c5bf"},"labelIndex":0,"zIndex":17,"selectedRelationships":["matched"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"a98cb126-a490-393f-adc6-d8a33df7046f","instanceIdentifier":"7802f548-0197-1000-68b4-418bf2a7c941","name":"","source":{"id":"fc8634fd-c7b5-346e-8c45-918b5e8d498d","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Upsert to Weaviate","comments":"","instanceIdentifier":"78027abd-0197-1000-8e3a-54c122fb6cdf"},"destination":{"id":"2946cb85-add1-36f1-9bf0-f27fc9f37454","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"LogAttribute","comments":"","instanceIdentifier":"701e57e0-0197-1000-4e15-2700cb97ad07"},"labelIndex":0,"zIndex":14,"selectedRelationships":["Response"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"67e3aea6-1895-3235-b5d5-ad2813bca6e5","instanceIdentifier":"74a48591-0197-1000-0e6b-f10003a8a795","name":"","source":{"id":"5adab250-799d-3f84-bbd2-4c4c8c7cfd14","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Generate Summary","comments":"","instanceIdentifier":"74a3d9a1-0197-1000-3d63-3ae85cdd7adf"},"destination":{"id":"b4c28cd1-7abe-34f9-8748-02584678767e","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Extract Summary","comments":"","instanceIdentifier":"74aa8e19-0197-1000-b460-fdb4ac3e16fc"},"labelIndex":0,"zIndex":8,"selectedRelationships":["Response"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"44ab269a-c397-3f2a-acd1-85370ed09ed8","instanceIdentifier":"701dab46-0197-1000-3468-6e2acbf31d6c","name":"","source":{"id":"36fbd810-3d0e-3bda-aae0-e823e6a38288","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"FetchFile","comments":"","instanceIdentifier":"701514bd-0197-1000-7899-68971eff9a70"},"destination":{"id":"5be86a18-5207-359b-bac9-04e00d6e8c90","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Metadata Mapping","comments":"To extract all the json files and map them to their images","instanceIdentifier":"701d7b2f-0197-1000-5929-3f4b6d128102"},"labelIndex":0,"zIndex":3,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"108f9e47-a844-3cdd-a794-7973cd46afb3","instanceIdentifier":"7394e70b-0197-1000-2a0c-81be6e52639e","name":"","source":{"id":"44845c8a-e889-31b0-ade5-6a3340c0c2b0","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"EncodeContent","comments":"","instanceIdentifier":"73947cb4-0197-1000-f7c2-44b435930aad"},"destination":{"id":"5d57b6ab-c54a-3e86-be95-2482bc910a28","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Payload for Summary","comments":"To make the json schema to feed the LLM having the base64 encoded image data","instanceIdentifier":"73eb48ce-0197-1000-ad10-295a79433eba"},"labelIndex":0,"zIndex":6,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"eb2886e2-853a-38f6-a85b-46e0526265f8","instanceIdentifier":"78124433-0197-1000-d154-0176f41a44ad","name":"","source":{"id":"fc8634fd-c7b5-346e-8c45-918b5e8d498d","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Upsert to Weaviate","comments":"","instanceIdentifier":"78027abd-0197-1000-8e3a-54c122fb6cdf"},"destination":{"id":"8056ba53-da3c-32e3-9fda-e09948a83020","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"LogAttribute","comments":"","instanceIdentifier":"78121f9f-0197-1000-9590-69bc78c3b540"},"labelIndex":0,"zIndex":15,"selectedRelationships":["Failure"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"f2ee2f42-e4e7-32dd-bc67-fa9d37d028af","instanceIdentifier":"701e9773-0197-1000-3dd2-76bdcd8e74a2","name":"","source":{"id":"5be86a18-5207-359b-bac9-04e00d6e8c90","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Metadata Mapping","comments":"To extract all the json files and map them to their images","instanceIdentifier":"701d7b2f-0197-1000-5929-3f4b6d128102"},"destination":{"id":"44845c8a-e889-31b0-ade5-6a3340c0c2b0","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"EncodeContent","comments":"","instanceIdentifier":"73947cb4-0197-1000-f7c2-44b435930aad"},"labelIndex":0,"zIndex":4,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"ab81f41d-eb00-30ed-bc8a-8cb9482a46e6","instanceIdentifier":"73ebcebc-0197-1000-f5b8-b8ced1ce7826","name":"","source":{"id":"5d57b6ab-c54a-3e86-be95-2482bc910a28","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Payload for Summary","comments":"To make the json schema to feed the LLM having the base64 encoded image data","instanceIdentifier":"73eb48ce-0197-1000-ad10-295a79433eba"},"destination":{"id":"5adab250-799d-3f84-bbd2-4c4c8c7cfd14","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Generate Summary","comments":"","instanceIdentifier":"74a3d9a1-0197-1000-3d63-3ae85cdd7adf"},"labelIndex":0,"zIndex":7,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"e755c066-0a90-3be6-93fa-04261935e0c6","instanceIdentifier":"74b3d2dc-0197-1000-db5c-5bfd928009c3","name":"","source":{"id":"b4c28cd1-7abe-34f9-8748-02584678767e","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Extract Summary","comments":"","instanceIdentifier":"74aa8e19-0197-1000-b460-fdb4ac3e16fc"},"destination":{"id":"c345fdc9-5068-37a5-b796-bac36815946a","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Prepare Embedding Payload","comments":"","instanceIdentifier":"777ec58b-0197-1000-df1f-9781e129f078"},"labelIndex":0,"zIndex":9,"selectedRelationships":["matched"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"bcc48be3-701f-30a2-87ea-71856fc3383b","instanceIdentifier":"777f1891-0197-1000-48f4-c51c2e092dba","name":"","source":{"id":"c345fdc9-5068-37a5-b796-bac36815946a","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Prepare Embedding Payload","comments":"","instanceIdentifier":"777ec58b-0197-1000-df1f-9781e129f078"},"destination":{"id":"cbefa712-d585-30eb-8d3b-e7a82f0bf008","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Generate Embedding","comments":"","instanceIdentifier":"77824cb7-0197-1000-7014-56035af82f16"},"labelIndex":0,"zIndex":10,"selectedRelationships":["success"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"},{"identifier":"fa0dd892-7182-3a44-b4e6-5f7b4d595dfd","instanceIdentifier":"7782aee4-0197-1000-3ae6-07abdfae65c8","name":"","source":{"id":"cbefa712-d585-30eb-8d3b-e7a82f0bf008","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Generate Embedding","comments":"","instanceIdentifier":"77824cb7-0197-1000-7014-56035af82f16"},"destination":{"id":"166d96de-7b41-323e-a504-5a37744a3892","type":"PROCESSOR","groupId":"01634c55-00f2-3c4f-a102-e70a13ecab8f","name":"Extract Embedding","comments":"","instanceIdentifier":"7785689b-0197-1000-1d2c-1e98d5497ae9"},"labelIndex":0,"zIndex":11,"selectedRelationships":["Response"],"backPressureObjectThreshold":10000,"backPressureDataSizeThreshold":"1 GB","flowFileExpiration":"0 sec","prioritizers":[],"bends":[],"loadBalanceStrategy":"DO_NOT_LOAD_BALANCE","partitioningAttribute":"","loadBalanceCompression":"DO_NOT_COMPRESS","componentType":"CONNECTION","groupIdentifier":"01634c55-00f2-3c4f-a102-e70a13ecab8f"}],"labels":[],"funnels":[],"controllerServices":[],"parameterContextName":"Photos Pipeline keys","defaultFlowFileExpiration":"0 sec","defaultBackPressureObjectThreshold":10000,"defaultBackPressureDataSizeThreshold":"1 GB","scheduledState":"ENABLED","executionEngine":"INHERITED","maxConcurrentTasks":1,"statelessFlowTimeout":"1 min","flowFileConcurrency":"UNBOUNDED","flowFileOutboundPolicy":"STREAM_WHEN_AVAILABLE","componentType":"PROCESS_GROUP"},"externalControllerServices":{},"parameterContexts":{"Photos Pipeline keys":{"name":"Photos Pipeline keys","parameters":[{"name":"weaviate-endpoint","description":"","sensitive":false,"provided":false,"value":"your-cluster-url-here"},{"name":"api-key","description":"","sensitive":true,"provided":false},{"name":"weaviate-api-key","description":"","sensitive":true,"provided":false},{"name":"embedding-endpoint","description":"","sensitive":false,"provided":false,"value":"embedding-endpoint-url-here"},{"name":"chat-endpoint","description":"","sensitive":false,"provided":false,"value":"chat-endpoint-url-here"}],"inheritedParameterContexts":[],"componentType":"PARAMETER_CONTEXT"}},"flowEncodingVersion":"1.0","parameterProviders":{},"latest":false}
